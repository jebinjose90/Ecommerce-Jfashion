<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inria+Sans%3A700" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bowlby+One+SC%3A400" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter%3A400%2C500%2C700%2C900" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro%3A400%2C500%2C700%2C900" />
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href="https://use.fontawesome.com/releases/v5.0.6/css/all.css" rel="stylesheet">
  <title>
    <%= title %>
  </title>
</head>
<style>
  body {
    font-family: Arial, sans-serif;
  }

  .foot {
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    padding: 20px;
    background-color: #000000;
  }

  .com_name {
    font-size: 24px;
    font-weight: bold;
    font-family: Inria Sans, 'Source Sans Pro';
    color: #ffffff;
  }

  .all_rights {
    display: flex;
    justify-content: center;
    padding: 10px;
    color: white;
  }

  .custom-div2 {
    height: 400px;
    width: 100%;
    background-color: #6badeb;
    /* Light Blue Background Color */
    color: white;
    /* White Text Color */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  .custom-div2 p {
    font-weight: bold;
    font-size: 3rem;
    font-family: Inria Sans, 'Source Sans Pro';
    line-height: 0.8;
    /* Adjust the font size as needed */
  }

  .custom-div2 p.small {
    font-size: 30px;
    font-weight: lighter;
    line-height: 0.8;
  }

  .custom-link {
    color: black;
  }

  .custom-link:hover {
    color: black;
  }

  .custom-input {
    border: none;
    outline: none;
    box-shadow: none;
    outline-width: 0;
  }

  .white-curved-div {
    background-color: white;
    height: 5.5rem;
    width: 40%;
    border-radius: 20px;
  }

  .dropdown-item:focus,
  .dropdown-item:hover {
    background-color: transparent;
    color: #000000;
    /* Change the color to your preferred text color */
  }

  .product-grid {
    font-family: 'Poppins', sans-serif;
  }

  .product-grid .product-image {
    overflow: hidden;
    position: relative;
    z-index: 1;
  }

  .product-grid .product-image a.image {
    display: block;
  }

  .product-grid .product-image img {
    width: 100%;
    height: auto;
  }

  .product-grid .product-image .img-1 {
    transition: all 0.3s ease 0s;
  }

  .product-grid:hover .product-image .img-1 {
    opacity: 0;
  }

  .product-grid .product-image .img-2 {
    width: 100%;
    height: 100%;
    opacity: 0;
    backface-visibility: hidden;
    position: absolute;
    left: 0;
    top: 0;
    z-index: -1;
    transition: all 0.3s ease 0s;
  }

  .product-grid:hover .product-image .img-2 {
    opacity: 1;
  }

  .product-grid .product-hot-label,
  .product-grid .product-discount-label {
    color: #fff;
    background: #ff6f00;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    padding: 3px 10px;
    position: absolute;
    top: 10px;
    left: 10px;
  }

  .product-grid .product-discount-label {
    background: #ff3939;
    left: auto;
    right: 10px;
  }

  .product-grid .product-view {
    color: #fff;
    background: #000;
    font-size: 16px;
    text-align: right;
    line-height: 50px;
    width: 60px;
    height: 60px;
    padding: 0 16px 0 0;
    border-radius: 50px;
    opacity: 0;
    transform: scale(0);
    position: absolute;
    bottom: -40px;
    left: -40px;
    transition: all .3s ease;
  }

  .product-grid:hover .product-view {
    opacity: 1;
    transform: scale(1);
    bottom: -20px;
    left: -20px;
  }

  .product-grid .product-view:hover {
    background: #ff6f00;
  }

  .product-grid .product-links {
    padding: 0;
    margin: 0;
    list-style: none;
    transform: translateY(50%);
    position: absolute;
    bottom: 50%;
    right: 10px;
    z-index: 1;
  }

  .product-grid .product-links li {
    margin: 5px 0;
    opacity: 0;
    transform: translateX(100%);
    transition: all .3s ease;
  }

  .product-grid .product-links li:nth-child(2) {
    transition-delay: .1s;
  }

  .product-grid .product-links li:nth-child(3) {
    transition-delay: .2s;
  }

  .product-grid:hover .product-links li {
    opacity: 1;
    transform: translateX(0);
  }

  .product-grid .product-links li a {
    color: #000;
    background: #fff;
    font-size: 18px;
    text-align: center;
    line-height: 33px;
    width: 35px;
    height: 35px;
    border: 1px solid #000;
    display: block;
    transition: all .3s ease;
  }

  .product-grid .product-links li a:hover {
    color: #fff;
    background: #ff6f00;
    border-color: #ff6f00;
  }

  .product-grid .product-content {
    background: #fff;
    padding: 15px 0 0;
  }

  .product-grid .rating {
    color: #f7bc3d;
    font-size: 11px;
    padding: 0;
    margin: 0 0 8px;
    list-style: none;
  }

  .product-grid .rating li {
    display: inline-block;
  }

  .product-grid .rating .disable {
    color: #a3a3a3;
  }

  .product-grid .title {
    font-size: 15px;
    font-weight: 500;
    text-transform: capitalize;
    margin: 0 0 8px;
  }

  .product-grid .title a {
    color: #333;
    transition: all 0.3s ease 0s;
  }

  .product-grid .title a:hover {
    color: #ff6f00;
  }

  .product-grid .price {
    color: #a3a3a3;
    font-size: 15px;
    font-weight: 500;
  }

  .product-grid .price span {
    color: #999;
    font-size: 14px;
    font-weight: 400;
    text-decoration: line-through;
    margin-right: 5px;
  }

  @media screen and (max-width: 990px) {
    .product-grid {
      margin-bottom: 30px;
    }
  }

  .image-container {
    display: flex;
    align-items: flex-start;
    /* Align items at the top */
  }

  .rounded-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 12px;
    padding: 5px;
    line-height: 1;
  }

  .btn-dark a {
    color: white;
    text-decoration: none;
  }

  .btn-dark a:hover {
    text-decoration: none;
    /* Remove underline on hover */
  }
</style>

<%- include('include/nav_bar_main_style') %>

  <body>

    <%- include('include/nav_bar_cart') %>
      <hr class="my-4 mt-1" style="border-color: gray;">
      <!--  -->

      <section class="mt-5">
        <div class="container ">
          <div class="row d-flex ">
            <div class="cart col-lg-9 ">
              <div class="table-responsive">
                <% if (cartItems && cartItems.length> 0) { %>
                  <table class="table">
                    <thead class="thead-dark bg-primary text-center">
                      <tr>
                        <th scope="col" class="text-white">Image</th>
                        <th scope="col" class="text-white">Product</th>
                        <th scope="col" class="text-white">Price</th>
                        <th scope="col" class="text-white">Quantity</th>
                        <th scope="col" class="text-white">Total</th>
                        <th scope="col" class="text-white">Action</th>
                      </tr>
                    </thead>
                    <tbody class="text-center">
                      <% cartItems.forEach((cart)=>{ %>
                        <tr class="text-center">
                          <td class="text-center">
                            <div class="main ">
                              <div class=" ">
                                <img style="width: 80px;height: 100px;" src="<%= cart.image[0] %>" alt="no img">
                              </div>
                            </div>
                          </td>
                          <td>
                            <div class="main">
                              <div class="des">
                                <p>
                                  <%= cart.product %>
                                </p>
                              </div>
                            </div>
                          </td>
                          <td>
                            <h6>
                              <%= currency %> <%= cart.price.toFixed(2) %>
                            </h6>
                          </td>
                          <td>
                            <div class="counter">

                              <a href="javascript:void(0);" onclick="increaseQuantity('<%= cart._id %>')"
                                style="background-color: transparent; border: none;" id="increaseButton" onclick="">
                                <button type="button" class="btn btn-dark rounded-btn">
                                  <i class="fas fa-plus text-white"></i>
                                </button>
                              </a>

                              <!-- Add this div where you want to display the out-of-stock message -->
                              <div id="error-message-<%= cart._id %>" style="display: none;" class="error-message">
                              </div>

                              <!-- Assuming you have an element with id 'quantity' to display the quantity -->
                              <input class="quantity input-number" min="1" max="1" type="text" disabled
                                value="<%= cart.quantity %>" data-product-id="<%= cart._id %>"
                                style="width: 30%; text-align: center; border: none; background-color: white;">


                              <a href="javascript:void(0);" onclick="decreaseQuantity('<%= cart._id %>')"
                                style="background-color: transparent; border: none;" id="decreaseButton" onclick="">
                                <button type="button" class="btn btn-dark rounded-btn">
                                  <i class="fas fa-minus text-white"></i>
                                </button>
                              </a>
                            </div>
                            <div class="messageContainer" id="messageContainer-<%= cart._id %>"></div>
                          </td>

                          <td>
                            <h6 class="total" data-product-id="<%= cart._id %>">
                              <%= currency %> <%= (cart.quantity * cart.price).toFixed(2) %>
                            </h6>
                          </td>
                          <td>
                            <a href="/removeItem/<%= cart._id %>" style="background-color: transparent; border: none;"
                              onclick="">
                              <button type="button" class="btn btn-dark rounded-btn">
                                <i class="fas fa-trash-alt"></i>
                              </button>
                            </a>
                          </td>
                        </tr>
                        <% }) %>
                    </tbody>
                  </table>
                  <% } else { %>
                    <script>
                      window.location.href = "/productsByCondition";
                    </script>
                    <% } %>
              </div>
            </div>
            <div class="col-lg-3">
              <div class="cart-summary">
                <h5>Total Price: <span id="total-price">
                  <% totalPrice = 0; %>
                  <% for (let i = 0; i < cartItems.length; i++) { %>
                    <% const itemPrice = parseFloat(cartItems[i].price); %>
                    <% if (!isNaN(itemPrice)) { %>
                      <% totalPrice += cartItems[i].quantity * itemPrice; %>
                    <% } %>
                  <% } %>
                  ₹<%= totalPrice.toFixed(2) %>
                </span></h5>

                <!-- Display the wallet amount with an icon -->

                <div class="checkout">
                  <% if (!cartItems) { %>
                    <p class="empty-cart-message">No items in the cart</p>
                    <% } else { %>
                      <% if (typeof message !=='undefined' ) { %>
                        <div class="alert alert-danger">
                          <%= message %>
                        </div>
                        <% } %>
                          <% } %>

                            <% if (!cartItems.length==0) { %>
                              <a href="/orderSummary">
                                <button id="placeOrder" type="submit" class="btn rounded-0"  style="background-color: #6badeb; color: #ffffff;">PROCEED TO CHECKOUT</button></a>
                              <% } %>
                </div>

              </div>
            </div>

          </div>
        </div>
      </section>

      <!--  -->
      <hr class="my-4 mt-1" style="border-color: gray;">

      <div class="custom-div2 d-flex">
        <div style="width:50%">
          <p style="font-weight: bold; text-align: center;">JOIN SHOPPING COMMUNITY TO GET MONTHLY PROMO</p>
        </div>
        <p class="small">Type our email down below and be young wild generation</p>
        <div class="white-curved-div d-flex justify-content-between align-items-center p-2">
          <input type="text" class="form-control custom-input" placeholder="Add your email here"
            style="width: 65%; font-size: 20px; margin-left: 4px;" />
          <button class="btn btn-dark"
            style="width: 30%; height: 90%; margin-right: 4px; font-size: 20px; border-radius: 15px;">SEND</button>
        </div>
      </div>


      <div class="foot d-flex">
        <div class="com_name mr-auto">JFASHION</div>

        <div class="all_rights mr-auto mt-4">
          <p>&copy; 2022 JFASHION. All rights reserved.</p>
        </div>
      </div>

      <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
      <script src="/js/zoomsl.js" type="text/javascript"></script>
      <script src="/js/zoomsl.min.js" type="text/javascript"></script>
      <%- include('include/nav_bar_main_script') %>
      
      
      <script>
        function updateTotalPrice(productId, newPrice, increaseAmount, decreaseAmount) {
            const totalElement = $('.total[data-product-id="' + productId + '"]');
            totalElement.text('₹' + newPrice.toFixed(2));

            // Calculate the sum of prices for all products
            let newOverallTotalPrice = 0;
            $('.total').each(function () {
                const productPrice = parseFloat($(this).text().replace('₹', ''));
                if (!isNaN(productPrice)) {
                    newOverallTotalPrice += productPrice;
                }
            });

            let totalprice = $('#total-price');
            totalprice.html('₹' + newOverallTotalPrice.toFixed(2));
            let totalprice2 = $('#total-price2');
            totalprice2.html('₹' + newOverallTotalPrice.toFixed(2));
        }

        async function updateQuantity(pid, isIncrease) {
            const url = isIncrease ? `/increaseCart/${pid}` : `/decreaseCart/${pid}`;

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                const data = await response.json();

                if (data.success) {
                    const quantityInput = $('.quantity[data-product-id="' + pid + '"]');
                    const productId = quantityInput.data('product-id');
                    quantityInput.val(data.newQuantity);

                    
                    const messageContainer = $('#messageContainer-' + productId);

                    if (data.success) {
                        messageContainer.hide();  // Hide the message container for success
                    } else {
                        messageContainer.show();  // Show the message container for failure
                        messageContainer.html(`<p>${data.message}</p>`);
                        setTimeout(() => {
                            messageContainer.hide();
                        }, 2000);
                    }

                    updateTotalPrice(
                        productId,
                        data.newPrice,
                        isIncrease ? data.newPrice - data.oldPrice : 0,
                        isIncrease ? 0 : data.oldPrice - data.newPrice
                    );
                } else {
                    const messageContainer = $('#messageContainer-' + pid);
                    messageContainer.show();
                    messageContainer.html(`<p>${data.message}</p>`);
                    setTimeout(() => {
                        messageContainer.hide();
                    }, 2000);
                }
            } catch (error) {
                console.error('Fetch error:', error);
                // Handle errors here
            }
        }



        function increaseQuantity(pid) {
            updateQuantity(pid, true);
        }

        function decreaseQuantity(pid) {
            updateQuantity(pid, false);
        }

        function showError(message) {
            const errorMessageDiv = $('#error-message');
            errorMessageDiv.text(message);
            errorMessageDiv.show();

            // Hide the error message after 3 seconds
            setTimeout(function () {
                errorMessageDiv.hide();
            }, 3000); // 3000 milliseconds = 3 seconds
        }
    </script> 
  </body>

</html>